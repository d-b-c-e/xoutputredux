<Window x:Class="XOutputRenew.App.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:XOutputRenew.App"
        xmlns:tb="http://www.hardcodet.net/taskbar"
        mc:Ignorable="d"
        Title="XOutputRenew"
        Height="700" Width="800"
        MinHeight="600" MinWidth="700"
        WindowStartupLocation="CenterScreen"
        Background="#1E1E1E"
        Icon="pack://application:,,,/console-controller.png"
        Closing="Window_Closing"
        StateChanged="Window_StateChanged">

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>

        <!-- Dark Theme Colors -->
        <SolidColorBrush x:Key="BackgroundBrush" Color="#1E1E1E"/>
        <SolidColorBrush x:Key="BackgroundSecondaryBrush" Color="#252526"/>
        <SolidColorBrush x:Key="ControlBackgroundBrush" Color="#2D2D30"/>
        <SolidColorBrush x:Key="ControlHoverBrush" Color="#3E3E42"/>
        <SolidColorBrush x:Key="BorderBrush" Color="#3F3F46"/>
        <SolidColorBrush x:Key="ForegroundBrush" Color="#E0E0E0"/>
        <SolidColorBrush x:Key="ForegroundDimBrush" Color="#9E9E9E"/>
        <SolidColorBrush x:Key="AccentBrush" Color="#0078D4"/>
        <SolidColorBrush x:Key="AccentGreenBrush" Color="#4CAF50"/>
        <SolidColorBrush x:Key="SelectionBrush" Color="#3E3E42"/>

        <!-- TabControl Style -->
        <Style TargetType="TabControl">
            <Setter Property="Background" Value="{StaticResource BackgroundBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
        </Style>

        <!-- TabItem Style -->
        <Style TargetType="TabItem">
            <Setter Property="Background" Value="{StaticResource ControlBackgroundBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="Padding" Value="12,6"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TabItem">
                        <Border x:Name="Border" Background="{StaticResource ControlBackgroundBrush}"
                                BorderBrush="{StaticResource BorderBrush}" BorderThickness="1,1,1,0"
                                Padding="{TemplateBinding Padding}" Margin="0,0,2,0">
                            <ContentPresenter ContentSource="Header"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="{StaticResource BackgroundSecondaryBrush}"/>
                                <Setter Property="Foreground" Value="White"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="{StaticResource ControlHoverBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Button Style -->
        <Style TargetType="Button">
            <Setter Property="Background" Value="{StaticResource ControlBackgroundBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="1" CornerRadius="3"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="{StaticResource ControlHoverBrush}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="{StaticResource AccentBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- ListView Style -->
        <Style TargetType="ListView">
            <Setter Property="Background" Value="{StaticResource BackgroundSecondaryBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
        </Style>

        <!-- ListViewItem Style -->
        <Style TargetType="ListViewItem">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}"/>
            <Setter Property="Padding" Value="5,3"/>
            <Style.Triggers>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="{StaticResource AccentBrush}"/>
                </Trigger>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{StaticResource ControlHoverBrush}"/>
                </Trigger>
                <DataTrigger Binding="{Binding IsActive}" Value="True">
                    <Setter Property="Background" Value="#FF8C00"/>
                    <Setter Property="FontWeight" Value="Bold"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <!-- GridViewColumnHeader Style -->
        <Style TargetType="GridViewColumnHeader">
            <Setter Property="Background" Value="{StaticResource ControlBackgroundBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="Padding" Value="8,4"/>
        </Style>

        <!-- GroupBox Style -->
        <Style TargetType="GroupBox">
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}"/>
        </Style>

        <!-- CheckBox Style -->
        <Style TargetType="CheckBox">
            <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}"/>
        </Style>

        <!-- ComboBox ToggleButton Template -->
        <ControlTemplate x:Key="ComboBoxToggleButton" TargetType="ToggleButton">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition/>
                    <ColumnDefinition Width="20"/>
                </Grid.ColumnDefinitions>
                <Border x:Name="Border" Grid.ColumnSpan="2"
                        Background="{StaticResource ControlBackgroundBrush}"
                        BorderBrush="{StaticResource BorderBrush}"
                        BorderThickness="1"/>
                <Border Grid.Column="0" Margin="1"
                        Background="{StaticResource ControlBackgroundBrush}"/>
                <Path x:Name="Arrow" Grid.Column="1"
                      HorizontalAlignment="Center" VerticalAlignment="Center"
                      Data="M 0 0 L 4 4 L 8 0 Z"
                      Fill="{StaticResource ForegroundBrush}"/>
            </Grid>
            <ControlTemplate.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter TargetName="Border" Property="Background" Value="{StaticResource ControlHoverBrush}"/>
                </Trigger>
            </ControlTemplate.Triggers>
        </ControlTemplate>

        <!-- ComboBox Style with dark popup -->
        <Style TargetType="ComboBox">
            <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}"/>
            <Setter Property="Background" Value="{StaticResource ControlBackgroundBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ComboBox">
                        <Grid>
                            <ToggleButton x:Name="ToggleButton"
                                          Template="{StaticResource ComboBoxToggleButton}"
                                          Focusable="False"
                                          IsChecked="{Binding IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
                                          ClickMode="Press"/>
                            <ContentPresenter x:Name="ContentSite"
                                              IsHitTestVisible="False"
                                              Content="{TemplateBinding SelectionBoxItem}"
                                              ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                                              ContentTemplateSelector="{TemplateBinding ItemTemplateSelector}"
                                              Margin="6,3,23,3"
                                              VerticalAlignment="Center"
                                              HorizontalAlignment="Left"/>
                            <Popup x:Name="Popup"
                                   Placement="Bottom"
                                   IsOpen="{TemplateBinding IsDropDownOpen}"
                                   AllowsTransparency="True"
                                   Focusable="False"
                                   PopupAnimation="Slide">
                                <Grid x:Name="DropDown"
                                      SnapsToDevicePixels="True"
                                      MinWidth="{TemplateBinding ActualWidth}"
                                      MaxHeight="{TemplateBinding MaxDropDownHeight}">
                                    <Border x:Name="DropDownBorder"
                                            Background="{StaticResource ControlBackgroundBrush}"
                                            BorderBrush="{StaticResource BorderBrush}"
                                            BorderThickness="1"/>
                                    <ScrollViewer Margin="2" SnapsToDevicePixels="True">
                                        <StackPanel IsItemsHost="True" KeyboardNavigation.DirectionalNavigation="Contained"/>
                                    </ScrollViewer>
                                </Grid>
                            </Popup>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- ComboBoxItem Style (dropdown items) - custom template for dark mode -->
        <Style TargetType="ComboBoxItem">
            <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}"/>
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ComboBoxItem">
                        <Border x:Name="Bd"
                                Background="{StaticResource ControlBackgroundBrush}"
                                Padding="4,2">
                            <ContentPresenter VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsHighlighted" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="{StaticResource SelectionBrush}"/>
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="{StaticResource SelectionBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- TextBlock default style -->
        <Style TargetType="TextBlock">
            <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}"/>
        </Style>

        <!-- StatusBar Style -->
        <Style TargetType="StatusBar">
            <Setter Property="Background" Value="{StaticResource ControlBackgroundBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}"/>
        </Style>

        <!-- ProgressBar Style -->
        <Style TargetType="ProgressBar">
            <Setter Property="Background" Value="{StaticResource ControlBackgroundBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource AccentGreenBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
        </Style>

        <!-- ScrollViewer Style -->
        <Style TargetType="ScrollViewer">
            <Setter Property="Background" Value="Transparent"/>
        </Style>

        <!-- ContextMenu Style -->
        <Style TargetType="ContextMenu">
            <Setter Property="Background" Value="{StaticResource ControlBackgroundBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
        </Style>

        <!-- MenuItem Style -->
        <Style TargetType="MenuItem">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}"/>
        </Style>
    </Window.Resources>

    <Grid Background="{StaticResource BackgroundBrush}">
        <!-- System Tray Icon -->
        <tb:TaskbarIcon x:Name="TrayIcon"
                        ToolTipText="XOutputRenew"
                        IconSource="app.ico"
                        Visibility="Visible">
            <tb:TaskbarIcon.ContextMenu>
                <ContextMenu>
                    <MenuItem Header="Show" Click="TrayIcon_Show_Click"/>
                    <Separator/>
                    <MenuItem Header="Exit" Click="TrayIcon_Exit_Click"/>
                </ContextMenu>
            </tb:TaskbarIcon.ContextMenu>
        </tb:TaskbarIcon>

        <Grid Margin="10">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Header -->
            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
                <TextBlock Text="XOutputRenew" FontSize="24" FontWeight="Bold" VerticalAlignment="Center"/>
                <TextBlock Text=" - Xbox Controller Emulator" FontSize="14" VerticalAlignment="Center"
                           Foreground="Gray" Margin="5,6,0,0"/>
            </StackPanel>

            <!-- Main Content - Tab Control -->
            <TabControl Grid.Row="1" SelectedIndex="1">
                <!-- Devices Tab -->
                <TabItem Header="Devices">
                    <Grid Margin="10">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
                            <Button Content="Refresh" Padding="15,5" Click="RefreshDevices_Click"/>
                            <TextBlock x:Name="DeviceCountText" VerticalAlignment="Center" Margin="15,0,0,0"
                                       Foreground="Gray"/>
                            <Separator Margin="20,0"/>
                            <CheckBox x:Name="ListenForInputCheckBox" Content="Listen for Input"
                                      VerticalAlignment="Center" Checked="ListenForInput_Changed"
                                      Unchecked="ListenForInput_Changed"/>
                            <CheckBox x:Name="VerboseLoggingCheckBox" Content="Verbose Log"
                                      VerticalAlignment="Center" Margin="15,0,0,0"
                                      Checked="VerboseLogging_Changed" Unchecked="VerboseLogging_Changed"
                                      ToolTip="Enable detailed logging to diagnose devices that don't register input. Check log file in %AppData%\XOutputRenew\logs"/>
                        </StackPanel>

                        <ListView x:Name="DeviceListView" Grid.Row="1"
                                  SelectionChanged="DeviceListView_SelectionChanged">
                            <ListView.ContextMenu>
                                <ContextMenu>
                                    <MenuItem Header="Show Device Info" Click="ShowDeviceInfo_Click"/>
                                    <MenuItem Header="Rename Device..." Click="RenameDevice_Click"/>
                                </ContextMenu>
                            </ListView.ContextMenu>
                            <ListView.View>
                                <GridView>
                                    <GridViewColumn Header="Name" Width="200"
                                                    DisplayMemberBinding="{Binding DisplayName}"/>
                                    <GridViewColumn Header="Method" Width="100"
                                                    DisplayMemberBinding="{Binding Method}"/>
                                    <GridViewColumn Header="Hardware ID" Width="180"
                                                    DisplayMemberBinding="{Binding HardwareId}"/>
                                    <GridViewColumn Header="Sources" Width="150"
                                                    DisplayMemberBinding="{Binding SourcesSummary}"/>
                                </GridView>
                            </ListView.View>
                            <ListView.ItemContainerStyle>
                                <Style TargetType="ListViewItem">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsActive}" Value="True">
                                            <Setter Property="Background" Value="#FFFFCC00"/>
                                            <Setter Property="FontWeight" Value="Bold"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </ListView.ItemContainerStyle>
                        </ListView>
                    </Grid>
                </TabItem>

                <!-- Profiles Tab -->
                <TabItem Header="Profiles">
                    <Grid Margin="10">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
                            <Button Content="New Profile" Padding="15,5" Click="NewProfile_Click"/>
                            <Separator Margin="20,0"/>
                            <Button x:Name="StartStopButton" Content="Start" Padding="20,5"
                                    Click="StartStopProfile_Click" IsEnabled="False"
                                    Background="#4CAF50" Foreground="White" FontWeight="Bold"/>
                            <Separator Margin="20,0"/>
                            <Button Content="Game Controllers" Padding="15,5" Click="OpenGameControllers_Click"
                                    ToolTip="Open Windows Game Controllers to test your devices"/>
                        </StackPanel>

                        <ListView x:Name="ProfileListView" Grid.Row="1"
                                  SelectionChanged="ProfileListView_SelectionChanged"
                                  MouseDoubleClick="ProfileListView_DoubleClick">
                            <ListView.ContextMenu>
                                <ContextMenu>
                                    <MenuItem Header="Edit" Click="EditProfile_Click"/>
                                    <MenuItem Header="Rename..." Click="RenameProfile_Click"/>
                                    <MenuItem Header="Duplicate..." Click="DuplicateProfile_Click"/>
                                    <Separator/>
                                    <MenuItem Header="Delete" Click="DeleteProfile_Click"/>
                                </ContextMenu>
                            </ListView.ContextMenu>
                            <ListView.View>
                                <GridView>
                                    <GridViewColumn Header="Name" Width="200"
                                                    DisplayMemberBinding="{Binding Name}"/>
                                    <GridViewColumn Header="Description" Width="250"
                                                    DisplayMemberBinding="{Binding Description}"/>
                                    <GridViewColumn Header="Bindings" Width="80"
                                                    DisplayMemberBinding="{Binding TotalBindings}"/>
                                    <GridViewColumn Header="Status" Width="100"
                                                    DisplayMemberBinding="{Binding Status}"/>
                                </GridView>
                            </ListView.View>
                        </ListView>
                    </Grid>
                </TabItem>

                <!-- Status Tab -->
                <TabItem Header="Status">
                    <Grid Margin="10">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- ViGEm Status -->
                        <GroupBox Grid.Row="0" Header="ViGEm Status" Margin="0,0,0,10">
                            <StackPanel Margin="10">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Driver Status: "/>
                                    <TextBlock x:Name="ViGEmStatusText" Text="Checking..." FontWeight="Bold"/>
                                </StackPanel>
                                <TextBlock x:Name="ViGEmInfoText" Foreground="Gray" Margin="0,5,0,0"/>
                            </StackPanel>
                        </GroupBox>

                        <!-- HidHide Status -->
                        <GroupBox Grid.Row="1" Header="HidHide Status" Margin="0,0,0,10">
                            <StackPanel Margin="10">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Driver Status: " VerticalAlignment="Center"/>
                                    <TextBlock x:Name="HidHideStatusText" Text="Checking..." FontWeight="Bold" VerticalAlignment="Center"/>
                                    <Button x:Name="InstallHidHideButton" Content="Install" Margin="10,0,0,0"
                                            Padding="10,3" Click="InstallHidHide_Click" Visibility="Collapsed"/>
                                </StackPanel>
                                <TextBlock x:Name="HidHideInfoText" Foreground="Gray" Margin="0,5,0,0"/>
                            </StackPanel>
                        </GroupBox>

                        <!-- Active Emulation -->
                        <GroupBox Grid.Row="2" Header="Active Emulation">
                            <StackPanel Margin="10">
                                <TextBlock x:Name="ActiveProfileText" Text="No profile running"/>
                            </StackPanel>
                        </GroupBox>
                    </Grid>
                </TabItem>

                <!-- Options Tab -->
                <TabItem Header="Options">
                    <Grid Margin="10">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Behavior -->
                        <GroupBox Grid.Row="0" Header="Behavior" Margin="0,0,0,10">
                            <StackPanel Margin="10">
                                <CheckBox x:Name="MinimizeToTrayCheckBox" Content="Minimize to tray when closing"
                                          Checked="MinimizeToTray_Changed" Unchecked="MinimizeToTray_Changed"/>
                                <TextBlock Text="When unchecked, closing the window will exit the application."
                                           Foreground="Gray" Margin="20,5,0,0" FontSize="11"/>
                            </StackPanel>
                        </GroupBox>

                        <!-- Startup -->
                        <GroupBox Grid.Row="1" Header="Startup" Margin="0,0,0,10">
                            <StackPanel Margin="10">
                                <CheckBox x:Name="StartWithWindowsCheckBox" Content="Start with Windows"
                                          Checked="StartWithWindows_Changed" Unchecked="StartWithWindows_Changed"/>
                                <TextBlock Text="Application will start minimized to tray when Windows starts."
                                           Foreground="Gray" Margin="20,5,0,0" FontSize="11"/>

                                <StackPanel Orientation="Horizontal" Margin="0,15,0,0">
                                    <TextBlock Text="Startup Profile:" VerticalAlignment="Center"/>
                                    <ComboBox x:Name="StartupProfileComboBox" Width="200" Margin="10,0,0,0"
                                              SelectionChanged="StartupProfile_Changed"/>
                                </StackPanel>
                                <TextBlock Text="Profile to start automatically when the application launches."
                                           Foreground="Gray" Margin="20,5,0,0" FontSize="11"/>
                            </StackPanel>
                        </GroupBox>

                        <!-- Administrator -->
                        <GroupBox Grid.Row="2" Header="Administrator" Margin="0,0,0,10">
                            <StackPanel Margin="10">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Running as Administrator: " VerticalAlignment="Center"/>
                                    <TextBlock x:Name="AdminStatusText" Text="No" FontWeight="Bold" VerticalAlignment="Center"/>
                                </StackPanel>
                                <TextBlock Text="Some devices may require administrator privileges to access."
                                           Foreground="Gray" Margin="0,5,0,0" FontSize="11"/>
                                <Button x:Name="RestartAsAdminButton" Content="Restart as Administrator"
                                        Padding="15,5" Margin="0,10,0,0" HorizontalAlignment="Left"
                                        Click="RestartAsAdmin_Click"/>
                            </StackPanel>
                        </GroupBox>

                        <!-- Command Line -->
                        <GroupBox Grid.Row="3" Header="Command Line">
                            <StackPanel Margin="10">
                                <StackPanel Orientation="Horizontal">
                                    <CheckBox x:Name="AddToPathCheckBox" Content="Add to System PATH"
                                              Checked="AddToPath_Changed" Unchecked="AddToPath_Changed"/>
                                    <TextBlock Text="?" FontWeight="Bold" Foreground="#64B5F6" Margin="10,0,0,0"
                                               VerticalAlignment="Center" Cursor="Hand"
                                               MouseLeftButtonUp="PathHelp_Click"
                                               ToolTip="Click for help"/>
                                </StackPanel>
                                <TextBlock Text="Enable to run 'XOutputRenew.App start MyProfile' from any terminal."
                                           Foreground="Gray" Margin="20,5,0,0" FontSize="11"/>
                            </StackPanel>
                        </GroupBox>
                    </Grid>
                </TabItem>

                <!-- Test Tab -->
                <TabItem Header="Test">
                    <Grid Margin="10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="2*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- Visual Controller -->
                        <Border Grid.Column="0" Background="#F8F8F8" BorderBrush="#CCCCCC" BorderThickness="1" CornerRadius="5">
                            <Grid>
                                <!-- "No profile running" overlay -->
                                <Border x:Name="TestOverlay" Background="#F0F0F0" CornerRadius="5" Visibility="Visible">
                                    <TextBlock Text="Start a profile to see controller output"
                                               HorizontalAlignment="Center" VerticalAlignment="Top"
                                               Margin="0,20,0,0" FontSize="16" Foreground="#888888"/>
                                </Border>

                                <!-- Controller Canvas -->
                                <Canvas x:Name="ControllerCanvas" Width="420" Height="320" Margin="10"
                                        HorizontalAlignment="Center" VerticalAlignment="Center">

                                    <!-- Left Trigger -->
                                    <Border Canvas.Left="50" Canvas.Top="5" Width="45" Height="50"
                                            BorderBrush="#999999" BorderThickness="1" CornerRadius="3" Background="#E8E8E8">
                                        <Grid>
                                            <Rectangle x:Name="LeftTriggerFill" Fill="#2196F3"
                                                       VerticalAlignment="Bottom" Height="0"/>
                                            <TextBlock Text="LT" HorizontalAlignment="Center" VerticalAlignment="Top"
                                                       Margin="0,2,0,0" FontSize="10" Foreground="#666666"/>
                                        </Grid>
                                    </Border>

                                    <!-- Right Trigger -->
                                    <Border Canvas.Left="325" Canvas.Top="5" Width="45" Height="50"
                                            BorderBrush="#999999" BorderThickness="1" CornerRadius="3" Background="#E8E8E8">
                                        <Grid>
                                            <Rectangle x:Name="RightTriggerFill" Fill="#2196F3"
                                                       VerticalAlignment="Bottom" Height="0"/>
                                            <TextBlock Text="RT" HorizontalAlignment="Center" VerticalAlignment="Top"
                                                       Margin="0,2,0,0" FontSize="10" Foreground="#666666"/>
                                        </Grid>
                                    </Border>

                                    <!-- Left Bumper -->
                                    <Border Canvas.Left="45" Canvas.Top="60" Width="55" Height="22"
                                            BorderBrush="#999999" BorderThickness="1" CornerRadius="10" Background="#CCCCCC">
                                        <Ellipse x:Name="ButtonLB" Fill="#CCCCCC"/>
                                    </Border>
                                    <TextBlock Canvas.Left="66" Canvas.Top="63" Text="LB" FontSize="10" Foreground="#333333"/>

                                    <!-- Right Bumper -->
                                    <Border Canvas.Left="320" Canvas.Top="60" Width="55" Height="22"
                                            BorderBrush="#999999" BorderThickness="1" CornerRadius="10" Background="#CCCCCC">
                                        <Ellipse x:Name="ButtonRB" Fill="#CCCCCC"/>
                                    </Border>
                                    <TextBlock Canvas.Left="341" Canvas.Top="63" Text="RB" FontSize="10" Foreground="#333333"/>

                                    <!-- Back Button -->
                                    <Ellipse x:Name="ButtonBack" Canvas.Left="135" Canvas.Top="95" Width="35" Height="22"
                                             Fill="#CCCCCC" Stroke="#999999" StrokeThickness="1"/>
                                    <TextBlock Canvas.Left="142" Canvas.Top="101" Text="Back" FontSize="9" Foreground="#333333"/>

                                    <!-- Guide Button -->
                                    <Ellipse x:Name="ButtonGuide" Canvas.Left="190" Canvas.Top="90" Width="35" Height="35"
                                             Fill="#CCCCCC" Stroke="#999999" StrokeThickness="1"/>
                                    <TextBlock Canvas.Left="203" Canvas.Top="101" Text="G" FontSize="12" FontWeight="Bold" Foreground="#333333"/>

                                    <!-- Start Button -->
                                    <Ellipse x:Name="ButtonStart" Canvas.Left="245" Canvas.Top="95" Width="35" Height="22"
                                             Fill="#CCCCCC" Stroke="#999999" StrokeThickness="1"/>
                                    <TextBlock Canvas.Left="252" Canvas.Top="100" Text="Start" FontSize="9" Foreground="#333333"/>

                                    <!-- Left Stick Background -->
                                    <Ellipse Canvas.Left="55" Canvas.Top="130" Width="70" Height="70"
                                             Fill="#E0E0E0" Stroke="#999999" StrokeThickness="1"/>
                                    <!-- Left Stick Click -->
                                    <Ellipse x:Name="ButtonLS" Canvas.Left="72" Canvas.Top="147" Width="36" Height="36"
                                             Fill="#CCCCCC" Stroke="#888888" StrokeThickness="1"/>
                                    <!-- Left Stick Dot (moves) -->
                                    <Ellipse x:Name="LeftStickDot" Canvas.Left="82" Canvas.Top="157" Width="16" Height="16"
                                             Fill="#333333"/>
                                    <TextBlock Canvas.Left="82" Canvas.Top="205" Text="LS" FontSize="10" Foreground="#666666"/>

                                    <!-- D-Pad (lower center-left, aligned with right stick center) -->
                                    <Rectangle x:Name="DPadUp" Canvas.Left="149" Canvas.Top="226" Width="22" Height="22"
                                               Fill="#CCCCCC" Stroke="#999999" StrokeThickness="1"/>
                                    <Rectangle x:Name="DPadDown" Canvas.Left="149" Canvas.Top="270" Width="22" Height="22"
                                               Fill="#CCCCCC" Stroke="#999999" StrokeThickness="1"/>
                                    <Rectangle x:Name="DPadLeft" Canvas.Left="127" Canvas.Top="248" Width="22" Height="22"
                                               Fill="#CCCCCC" Stroke="#999999" StrokeThickness="1"/>
                                    <Rectangle x:Name="DPadRight" Canvas.Left="171" Canvas.Top="248" Width="22" Height="22"
                                               Fill="#CCCCCC" Stroke="#999999" StrokeThickness="1"/>
                                    <Rectangle Canvas.Left="149" Canvas.Top="248" Width="22" Height="22"
                                               Fill="#AAAAAA" Stroke="#999999" StrokeThickness="1"/>

                                    <!-- Face Buttons - diamond layout -->
                                    <Ellipse x:Name="ButtonY" Canvas.Left="320" Canvas.Top="115" Width="32" Height="32"
                                             Fill="#CCCCCC" Stroke="#999999" StrokeThickness="1"/>
                                    <TextBlock Canvas.Left="330" Canvas.Top="122" Text="Y" FontSize="12" FontWeight="Bold" Foreground="#333333"/>

                                    <Ellipse x:Name="ButtonX" Canvas.Left="285" Canvas.Top="145" Width="32" Height="32"
                                             Fill="#CCCCCC" Stroke="#999999" StrokeThickness="1"/>
                                    <TextBlock Canvas.Left="296" Canvas.Top="152" Text="X" FontSize="12" FontWeight="Bold" Foreground="#333333"/>

                                    <Ellipse x:Name="ButtonB" Canvas.Left="355" Canvas.Top="145" Width="32" Height="32"
                                             Fill="#CCCCCC" Stroke="#999999" StrokeThickness="1"/>
                                    <TextBlock Canvas.Left="366" Canvas.Top="152" Text="B" FontSize="12" FontWeight="Bold" Foreground="#333333"/>

                                    <Ellipse x:Name="ButtonA" Canvas.Left="320" Canvas.Top="175" Width="32" Height="32"
                                             Fill="#CCCCCC" Stroke="#999999" StrokeThickness="1"/>
                                    <TextBlock Canvas.Left="330" Canvas.Top="182" Text="A" FontSize="12" FontWeight="Bold" Foreground="#333333"/>

                                    <!-- Right Stick Background -->
                                    <Ellipse Canvas.Left="225" Canvas.Top="220" Width="70" Height="70"
                                             Fill="#E0E0E0" Stroke="#999999" StrokeThickness="1"/>
                                    <!-- Right Stick Click -->
                                    <Ellipse x:Name="ButtonRS" Canvas.Left="242" Canvas.Top="237" Width="36" Height="36"
                                             Fill="#CCCCCC" Stroke="#888888" StrokeThickness="1"/>
                                    <!-- Right Stick Dot (moves) -->
                                    <Ellipse x:Name="RightStickDot" Canvas.Left="252" Canvas.Top="247" Width="16" Height="16"
                                             Fill="#333333"/>
                                    <TextBlock Canvas.Left="252" Canvas.Top="295" Text="RS" FontSize="10" Foreground="#666666"/>
                                </Canvas>
                            </Grid>
                        </Border>

                        <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Center"
                                      VerticalAlignment="Stretch" Background="Transparent"/>

                        <!-- Data Panel -->
                        <ScrollViewer Grid.Column="2" VerticalScrollBarVisibility="Auto">
                            <StackPanel Margin="10">
                                <!-- Profile Status -->
                                <TextBlock x:Name="TestProfileStatus" Text="No Profile Running"
                                           FontWeight="Bold" FontSize="12" Foreground="#888888"
                                           Margin="0,0,0,10"/>

                                <!-- Buttons -->
                                <GroupBox Header="Buttons" Margin="0,0,0,10">
                                    <Grid Margin="5">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <TextBlock Grid.Row="0" Grid.Column="0" x:Name="TextA" Text="A: -" Margin="2"/>
                                        <TextBlock Grid.Row="0" Grid.Column="1" x:Name="TextB" Text="B: -" Margin="2"/>
                                        <TextBlock Grid.Row="1" Grid.Column="0" x:Name="TextX" Text="X: -" Margin="2"/>
                                        <TextBlock Grid.Row="1" Grid.Column="1" x:Name="TextY" Text="Y: -" Margin="2"/>
                                        <TextBlock Grid.Row="2" Grid.Column="0" x:Name="TextLB" Text="LB: -" Margin="2"/>
                                        <TextBlock Grid.Row="2" Grid.Column="1" x:Name="TextRB" Text="RB: -" Margin="2"/>
                                        <TextBlock Grid.Row="3" Grid.Column="0" x:Name="TextBack" Text="Back: -" Margin="2"/>
                                        <TextBlock Grid.Row="3" Grid.Column="1" x:Name="TextStart" Text="Start: -" Margin="2"/>
                                        <TextBlock Grid.Row="4" Grid.Column="0" x:Name="TextGuide" Text="Guide: -" Margin="2"/>
                                        <TextBlock Grid.Row="4" Grid.Column="1" x:Name="TextLS" Text="LS: -" Margin="2"/>
                                        <TextBlock Grid.Row="5" Grid.Column="0" x:Name="TextRS" Text="RS: -" Margin="2"/>
                                        <TextBlock Grid.Row="6" Grid.Column="0" x:Name="TextDPadUp" Text="DPad Up: -" Margin="2"/>
                                        <TextBlock Grid.Row="6" Grid.Column="1" x:Name="TextDPadDown" Text="DPad Down: -" Margin="2"/>
                                        <TextBlock Grid.Row="7" Grid.Column="0" x:Name="TextDPadLeft" Text="DPad Left: -" Margin="2"/>
                                        <TextBlock Grid.Row="7" Grid.Column="1" x:Name="TextDPadRight" Text="DPad Right: -" Margin="2"/>
                                    </Grid>
                                </GroupBox>

                                <!-- Triggers -->
                                <GroupBox Header="Triggers" Margin="0,0,0,10">
                                    <StackPanel Margin="5">
                                        <StackPanel Orientation="Horizontal" Margin="0,2">
                                            <TextBlock Text="LT: " Width="30"/>
                                            <ProgressBar x:Name="BarLT" Width="100" Height="15" Minimum="0" Maximum="100" Value="0"/>
                                            <TextBlock x:Name="TextLT" Text="0.00" Margin="5,0,0,0" Width="40"/>
                                        </StackPanel>
                                        <StackPanel Orientation="Horizontal" Margin="0,2">
                                            <TextBlock Text="RT: " Width="30"/>
                                            <ProgressBar x:Name="BarRT" Width="100" Height="15" Minimum="0" Maximum="100" Value="0"/>
                                            <TextBlock x:Name="TextRT" Text="0.00" Margin="5,0,0,0" Width="40"/>
                                        </StackPanel>
                                    </StackPanel>
                                </GroupBox>

                                <!-- Axes -->
                                <GroupBox Header="Left Stick" Margin="0,0,0,10">
                                    <StackPanel Margin="5">
                                        <StackPanel Orientation="Horizontal" Margin="0,2">
                                            <TextBlock Text="X: " Width="20"/>
                                            <ProgressBar x:Name="BarLSX" Width="100" Height="15" Minimum="0" Maximum="100" Value="50"/>
                                            <TextBlock x:Name="TextLSX" Text="0.50" Margin="5,0,0,0" Width="40"/>
                                        </StackPanel>
                                        <StackPanel Orientation="Horizontal" Margin="0,2">
                                            <TextBlock Text="Y: " Width="20"/>
                                            <ProgressBar x:Name="BarLSY" Width="100" Height="15" Minimum="0" Maximum="100" Value="50"/>
                                            <TextBlock x:Name="TextLSY" Text="0.50" Margin="5,0,0,0" Width="40"/>
                                        </StackPanel>
                                    </StackPanel>
                                </GroupBox>

                                <GroupBox Header="Right Stick" Margin="0,0,0,10">
                                    <StackPanel Margin="5">
                                        <StackPanel Orientation="Horizontal" Margin="0,2">
                                            <TextBlock Text="X: " Width="20"/>
                                            <ProgressBar x:Name="BarRSX" Width="100" Height="15" Minimum="0" Maximum="100" Value="50"/>
                                            <TextBlock x:Name="TextRSX" Text="0.50" Margin="5,0,0,0" Width="40"/>
                                        </StackPanel>
                                        <StackPanel Orientation="Horizontal" Margin="0,2">
                                            <TextBlock Text="Y: " Width="20"/>
                                            <ProgressBar x:Name="BarRSY" Width="100" Height="15" Minimum="0" Maximum="100" Value="50"/>
                                            <TextBlock x:Name="TextRSY" Text="0.50" Margin="5,0,0,0" Width="40"/>
                                        </StackPanel>
                                    </StackPanel>
                                </GroupBox>
                            </StackPanel>
                        </ScrollViewer>
                    </Grid>
                </TabItem>
            </TabControl>

            <!-- Status Bar -->
            <StatusBar Grid.Row="2" Margin="0,10,0,0">
                <StatusBarItem>
                    <TextBlock x:Name="StatusText" Text="Ready"/>
                </StatusBarItem>
            </StatusBar>
        </Grid>
    </Grid>
</Window>
