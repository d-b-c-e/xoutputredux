<Window x:Class="XOutputRedux.App.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:XOutputRedux.App"
        xmlns:tb="http://www.hardcodet.net/taskbar"
        mc:Ignorable="d"
        Title="XOutputRedux"
        Height="700" Width="800"
        MinHeight="600" MinWidth="700"
        WindowStartupLocation="CenterScreen"
        Background="#1E1E1E"
        Icon="pack://application:,,,/Assets/Icons/favicon.ico"
        Closing="Window_Closing"
        StateChanged="Window_StateChanged">

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>

        <!-- Dark Theme Colors -->
        <SolidColorBrush x:Key="BackgroundBrush" Color="#1E1E1E"/>
        <SolidColorBrush x:Key="BackgroundSecondaryBrush" Color="#252526"/>
        <SolidColorBrush x:Key="ControlBackgroundBrush" Color="#2D2D30"/>
        <SolidColorBrush x:Key="ControlHoverBrush" Color="#3E3E42"/>
        <SolidColorBrush x:Key="BorderBrush" Color="#3F3F46"/>
        <SolidColorBrush x:Key="ForegroundBrush" Color="#E0E0E0"/>
        <SolidColorBrush x:Key="ForegroundDimBrush" Color="#9E9E9E"/>
        <SolidColorBrush x:Key="AccentBrush" Color="#0078D4"/>
        <SolidColorBrush x:Key="AccentGreenBrush" Color="#4CAF50"/>
        <SolidColorBrush x:Key="SelectionBrush" Color="#3E3E42"/>

        <!-- TabControl Style -->
        <Style TargetType="TabControl">
            <Setter Property="Background" Value="{StaticResource BackgroundBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
        </Style>

        <!-- TabItem Style -->
        <Style TargetType="TabItem">
            <Setter Property="Background" Value="{StaticResource ControlBackgroundBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="Padding" Value="12,6"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TabItem">
                        <Border x:Name="Border" Background="{StaticResource ControlBackgroundBrush}"
                                BorderBrush="{StaticResource BorderBrush}" BorderThickness="1,1,1,0"
                                Padding="{TemplateBinding Padding}" Margin="0,0,2,0">
                            <ContentPresenter ContentSource="Header"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="{StaticResource BackgroundSecondaryBrush}"/>
                                <Setter Property="Foreground" Value="White"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="{StaticResource ControlHoverBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Button Style -->
        <Style TargetType="Button">
            <Setter Property="Background" Value="{StaticResource ControlBackgroundBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="1" CornerRadius="3"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="{StaticResource ControlHoverBrush}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="{StaticResource AccentBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- ListView Style -->
        <Style TargetType="ListView">
            <Setter Property="Background" Value="{StaticResource BackgroundSecondaryBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
        </Style>

        <!-- ListViewItem Style -->
        <Style TargetType="ListViewItem">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}"/>
            <Setter Property="Padding" Value="5,3"/>
            <Style.Triggers>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="{StaticResource AccentBrush}"/>
                </Trigger>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{StaticResource ControlHoverBrush}"/>
                </Trigger>
                <DataTrigger Binding="{Binding IsActive}" Value="True">
                    <Setter Property="Background" Value="#FF8C00"/>
                    <Setter Property="FontWeight" Value="Bold"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <!-- GridViewColumnHeader Style -->
        <Style TargetType="GridViewColumnHeader">
            <Setter Property="Background" Value="{StaticResource ControlBackgroundBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="Padding" Value="8,4"/>
        </Style>

        <!-- GroupBox Style -->
        <Style TargetType="GroupBox">
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}"/>
        </Style>

        <!-- CheckBox Style -->
        <Style TargetType="CheckBox">
            <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}"/>
        </Style>

        <!-- ComboBox ToggleButton Template -->
        <ControlTemplate x:Key="ComboBoxToggleButton" TargetType="ToggleButton">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition/>
                    <ColumnDefinition Width="20"/>
                </Grid.ColumnDefinitions>
                <Border x:Name="Border" Grid.ColumnSpan="2"
                        Background="{StaticResource ControlBackgroundBrush}"
                        BorderBrush="{StaticResource BorderBrush}"
                        BorderThickness="1"/>
                <Border Grid.Column="0" Margin="1"
                        Background="{StaticResource ControlBackgroundBrush}"/>
                <Path x:Name="Arrow" Grid.Column="1"
                      HorizontalAlignment="Center" VerticalAlignment="Center"
                      Data="M 0 0 L 4 4 L 8 0 Z"
                      Fill="{StaticResource ForegroundBrush}"/>
            </Grid>
            <ControlTemplate.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter TargetName="Border" Property="Background" Value="{StaticResource ControlHoverBrush}"/>
                </Trigger>
            </ControlTemplate.Triggers>
        </ControlTemplate>

        <!-- ComboBox Style with dark popup -->
        <Style TargetType="ComboBox">
            <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}"/>
            <Setter Property="Background" Value="{StaticResource ControlBackgroundBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ComboBox">
                        <Grid>
                            <ToggleButton x:Name="ToggleButton"
                                          Template="{StaticResource ComboBoxToggleButton}"
                                          Focusable="False"
                                          IsChecked="{Binding IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
                                          ClickMode="Press"/>
                            <ContentPresenter x:Name="ContentSite"
                                              IsHitTestVisible="False"
                                              Content="{TemplateBinding SelectionBoxItem}"
                                              ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                                              ContentTemplateSelector="{TemplateBinding ItemTemplateSelector}"
                                              Margin="6,3,23,3"
                                              VerticalAlignment="Center"
                                              HorizontalAlignment="Left"/>
                            <Popup x:Name="Popup"
                                   Placement="Bottom"
                                   IsOpen="{TemplateBinding IsDropDownOpen}"
                                   AllowsTransparency="True"
                                   Focusable="False"
                                   PopupAnimation="Slide">
                                <Grid x:Name="DropDown"
                                      SnapsToDevicePixels="True"
                                      MinWidth="{TemplateBinding ActualWidth}"
                                      MaxHeight="{TemplateBinding MaxDropDownHeight}">
                                    <Border x:Name="DropDownBorder"
                                            Background="{StaticResource ControlBackgroundBrush}"
                                            BorderBrush="{StaticResource BorderBrush}"
                                            BorderThickness="1"/>
                                    <ScrollViewer Margin="2" SnapsToDevicePixels="True">
                                        <StackPanel IsItemsHost="True" KeyboardNavigation.DirectionalNavigation="Contained"/>
                                    </ScrollViewer>
                                </Grid>
                            </Popup>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- ComboBoxItem Style (dropdown items) - custom template for dark mode -->
        <Style TargetType="ComboBoxItem">
            <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}"/>
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ComboBoxItem">
                        <Border x:Name="Bd"
                                Background="{StaticResource ControlBackgroundBrush}"
                                Padding="4,2">
                            <ContentPresenter VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsHighlighted" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="{StaticResource SelectionBrush}"/>
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="{StaticResource SelectionBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- TextBlock default style -->
        <Style TargetType="TextBlock">
            <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}"/>
        </Style>

        <!-- StatusBar Style -->
        <Style TargetType="StatusBar">
            <Setter Property="Background" Value="{StaticResource ControlBackgroundBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}"/>
        </Style>

        <!-- ProgressBar Style -->
        <Style TargetType="ProgressBar">
            <Setter Property="Background" Value="{StaticResource ControlBackgroundBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource AccentGreenBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
        </Style>

        <!-- ScrollViewer Style -->
        <Style TargetType="ScrollViewer">
            <Setter Property="Background" Value="Transparent"/>
        </Style>

        <!-- ContextMenu Style -->
        <Style TargetType="ContextMenu">
            <Setter Property="Background" Value="{StaticResource ControlBackgroundBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
        </Style>

        <!-- MenuItem Style -->
        <Style TargetType="MenuItem">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}"/>
        </Style>
    </Window.Resources>

    <Grid Background="{StaticResource BackgroundBrush}">
        <!-- System Tray Icon -->
        <tb:TaskbarIcon x:Name="TrayIcon"
                        ToolTipText="XOutputRedux"
                        IconSource="pack://application:,,,/Assets/Icons/favicon.ico"
                        Visibility="Visible"
                        TrayMouseDoubleClick="TrayIcon_DoubleClick">
            <tb:TaskbarIcon.ContextMenu>
                <ContextMenu>
                    <MenuItem Header="Show" Click="TrayIcon_Show_Click"/>
                    <Separator/>
                    <MenuItem Header="Exit" Click="TrayIcon_Exit_Click"/>
                </ContextMenu>
            </tb:TaskbarIcon.ContextMenu>
        </tb:TaskbarIcon>

        <Grid Margin="10">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Header -->
            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
                <TextBlock Text="XOutputRedux" FontSize="24" FontWeight="Bold" VerticalAlignment="Center"/>
                <TextBlock Text=" - Xbox Controller Emulator" FontSize="14" VerticalAlignment="Center"
                           Foreground="Gray" Margin="5,6,0,0"/>
            </StackPanel>

            <!-- Main Content - Tab Control -->
            <TabControl Grid.Row="1" SelectedIndex="1">
                <!-- Devices Tab -->
                <TabItem Header="Devices">
                    <Grid Margin="10">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
                            <Button Content="Refresh" Padding="15,5" Click="RefreshDevices_Click"/>
                            <TextBlock x:Name="DeviceCountText" VerticalAlignment="Center" Margin="15,0,0,0"
                                       Foreground="Gray"/>
                            <Separator Margin="20,0"/>
                            <CheckBox x:Name="ListenForInputCheckBox" Content="Listen for Input"
                                      VerticalAlignment="Center" Checked="ListenForInput_Changed"
                                      Unchecked="ListenForInput_Changed"/>
                            <CheckBox x:Name="VerboseLoggingCheckBox" Content="Verbose Log"
                                      VerticalAlignment="Center" Margin="15,0,0,0"
                                      Checked="VerboseLogging_Changed" Unchecked="VerboseLogging_Changed"
                                      ToolTip="Enable detailed logging to diagnose devices that don't register input. Check log file in %AppData%\XOutputRedux\logs"/>
                        </StackPanel>

                        <ListView x:Name="DeviceListView" Grid.Row="1"
                                  SelectionChanged="DeviceListView_SelectionChanged">
                            <ListView.ContextMenu>
                                <ContextMenu>
                                    <MenuItem Header="Show Device Info" Click="ShowDeviceInfo_Click"/>
                                    <MenuItem Header="Rename Device..." Click="RenameDevice_Click"/>
                                </ContextMenu>
                            </ListView.ContextMenu>
                            <ListView.View>
                                <GridView>
                                    <GridViewColumn Header="Name" Width="200"
                                                    DisplayMemberBinding="{Binding DisplayName}"/>
                                    <GridViewColumn Header="Method" Width="100"
                                                    DisplayMemberBinding="{Binding Method}"/>
                                    <GridViewColumn Header="Hardware ID" Width="180"
                                                    DisplayMemberBinding="{Binding HardwareId}"/>
                                    <GridViewColumn Header="Sources" Width="150"
                                                    DisplayMemberBinding="{Binding SourcesSummary}"/>
                                </GridView>
                            </ListView.View>
                            <ListView.ItemContainerStyle>
                                <Style TargetType="ListViewItem">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsActive}" Value="True">
                                            <Setter Property="Background" Value="#FFFFCC00"/>
                                            <Setter Property="FontWeight" Value="Bold"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </ListView.ItemContainerStyle>
                        </ListView>
                    </Grid>
                </TabItem>

                <!-- Profiles Tab -->
                <TabItem Header="Profiles">
                    <Grid Margin="10">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
                            <Button Content="New Profile" Padding="15,5" Click="NewProfile_Click"/>
                            <Separator Margin="20,0"/>
                            <Button x:Name="StartStopButton" Content="Start" Padding="20,5"
                                    Click="StartStopProfile_Click" IsEnabled="False"
                                    Background="#4CAF50" Foreground="White" FontWeight="Bold"/>
                            <Separator Margin="20,0"/>
                            <Button Content="Game Controllers" Padding="15,5" Click="OpenGameControllers_Click"
                                    ToolTip="Open Windows Game Controllers to test your devices"/>
                        </StackPanel>

                        <ListView x:Name="ProfileListView" Grid.Row="1"
                                  SelectionChanged="ProfileListView_SelectionChanged"
                                  MouseDoubleClick="ProfileListView_DoubleClick">
                            <ListView.ContextMenu>
                                <ContextMenu>
                                    <MenuItem Header="Edit" Click="EditProfile_Click"/>
                                    <MenuItem Header="Rename..." Click="RenameProfile_Click"/>
                                    <MenuItem Header="Duplicate..." Click="DuplicateProfile_Click"/>
                                    <Separator/>
                                    <MenuItem Header="Delete" Click="DeleteProfile_Click"/>
                                </ContextMenu>
                            </ListView.ContextMenu>
                            <ListView.View>
                                <GridView>
                                    <GridViewColumn Header="Name" Width="200"
                                                    DisplayMemberBinding="{Binding Name}"/>
                                    <GridViewColumn Header="Description" Width="250"
                                                    DisplayMemberBinding="{Binding Description}"/>
                                    <GridViewColumn Header="Bindings" Width="80"
                                                    DisplayMemberBinding="{Binding TotalBindings}"/>
                                    <GridViewColumn Header="Status" Width="100"
                                                    DisplayMemberBinding="{Binding Status}"/>
                                </GridView>
                            </ListView.View>
                        </ListView>
                    </Grid>
                </TabItem>

                <!-- Games Tab -->
                <TabItem Header="Games">
                    <Grid Margin="10">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
                            <Button Content="Add Game" Padding="15,5" Click="AddGame_Click"/>
                            <Button Content="Edit" Padding="15,5" Margin="10,0,0,0" Click="EditGame_Click"
                                    x:Name="EditGameButton" IsEnabled="False"/>
                            <Button Content="Remove" Padding="15,5" Margin="10,0,0,0" Click="RemoveGame_Click"
                                    x:Name="RemoveGameButton" IsEnabled="False"/>
                            <Separator Margin="20,0"/>
                            <Button x:Name="GameMonitorButton" Content="Enable Monitoring" Padding="20,5"
                                    Click="ToggleGameMonitoring_Click"
                                    Background="#4CAF50" Foreground="White" FontWeight="Bold"
                                    ToolTip="Monitor for running games and auto-start profiles"/>
                        </StackPanel>

                        <!-- Monitor Status -->
                        <Border Grid.Row="1" Background="#2D2D30" Padding="10,8" CornerRadius="3" Margin="0,0,0,10">
                            <StackPanel Orientation="Horizontal">
                                <Ellipse x:Name="MonitorStatusIndicator" Width="10" Height="10" Fill="#888888"
                                         VerticalAlignment="Center" Margin="0,0,8,0"/>
                                <TextBlock x:Name="MonitorStatusText" Text="Monitoring disabled"
                                           Foreground="#9E9E9E" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Border>

                        <ListView x:Name="GamesListView" Grid.Row="2"
                                  SelectionChanged="GamesListView_SelectionChanged"
                                  MouseDoubleClick="GamesListView_DoubleClick">
                            <ListView.ContextMenu>
                                <ContextMenu>
                                    <MenuItem Header="Edit" Click="EditGame_Click"/>
                                    <MenuItem Header="Remove" Click="RemoveGame_Click"/>
                                </ContextMenu>
                            </ListView.ContextMenu>
                            <ListView.View>
                                <GridView>
                                    <GridViewColumn Header="Game" Width="200"
                                                    DisplayMemberBinding="{Binding Name}"/>
                                    <GridViewColumn Header="Executable" Width="300">
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding ExecutablePath}" TextTrimming="CharacterEllipsis"
                                                           ToolTip="{Binding ExecutablePath}"/>
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                    <GridViewColumn Header="Profile" Width="150"
                                                    DisplayMemberBinding="{Binding ProfileName}"/>
                                </GridView>
                            </ListView.View>
                            <ListView.ItemContainerStyle>
                                <Style TargetType="ListViewItem" BasedOn="{StaticResource {x:Type ListViewItem}}">
                                    <Setter Property="ToolTip" Value="{Binding ExecutablePath}"/>
                                </Style>
                            </ListView.ItemContainerStyle>
                        </ListView>
                    </Grid>
                </TabItem>

                <!-- Status Tab -->
                <TabItem Header="Status">
                    <Grid Margin="10">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- ViGEm Status -->
                        <GroupBox Grid.Row="0" Header="ViGEm Status" Margin="0,0,0,10">
                            <StackPanel Margin="10">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Driver Status: " VerticalAlignment="Center"/>
                                    <TextBlock x:Name="ViGEmStatusText" Text="Checking..." FontWeight="Bold" VerticalAlignment="Center"/>
                                    <Button x:Name="InstallViGEmButton" Content="Install" Margin="10,0,0,0"
                                            Padding="10,3" Click="InstallViGEm_Click" Visibility="Collapsed"/>
                                </StackPanel>
                                <TextBlock x:Name="ViGEmInfoText" Foreground="Gray" Margin="0,5,0,0"/>
                            </StackPanel>
                        </GroupBox>

                        <!-- HidHide Status -->
                        <GroupBox Grid.Row="1" Header="HidHide Status" Margin="0,0,0,10">
                            <StackPanel Margin="10">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Driver Status: " VerticalAlignment="Center"/>
                                    <TextBlock x:Name="HidHideStatusText" Text="Checking..." FontWeight="Bold" VerticalAlignment="Center"/>
                                    <Button x:Name="InstallHidHideButton" Content="Install" Margin="10,0,0,0"
                                            Padding="10,3" Click="InstallHidHide_Click" Visibility="Collapsed"/>
                                </StackPanel>
                                <TextBlock x:Name="HidHideInfoText" Foreground="Gray" Margin="0,5,0,0"/>
                            </StackPanel>
                        </GroupBox>

                        <!-- Active Emulation -->
                        <GroupBox Grid.Row="2" Header="Active Emulation">
                            <StackPanel Margin="10">
                                <TextBlock x:Name="ActiveProfileText" Text="No profile running"/>
                            </StackPanel>
                        </GroupBox>
                    </Grid>
                </TabItem>

                <!-- Options Tab -->
                <TabItem Header="Options">
                    <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                    <Grid Margin="10">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Behavior -->
                        <GroupBox Grid.Row="0" Header="Behavior" Margin="0,0,0,10">
                            <StackPanel Margin="10">
                                <CheckBox x:Name="MinimizeToTrayCheckBox" Content="Minimize to tray when closing"
                                          Checked="MinimizeToTray_Changed" Unchecked="MinimizeToTray_Changed"/>
                                <TextBlock Text="When unchecked, closing the window will exit the application."
                                           Foreground="Gray" Margin="20,5,0,0" FontSize="11"/>

                                <CheckBox x:Name="ToastNotificationsCheckBox" Content="Show toast notifications"
                                          Margin="0,15,0,0"
                                          Checked="ToastNotifications_Changed" Unchecked="ToastNotifications_Changed"/>
                                <TextBlock Text="Show Windows notifications when profiles start/stop and games are detected."
                                           Foreground="Gray" Margin="20,5,0,0" FontSize="11"/>

                                <CheckBox x:Name="CrashReportingCheckBox" Content="Show crash reporting dialog"
                                          Margin="0,15,0,0"
                                          Checked="CrashReporting_Changed" Unchecked="CrashReporting_Changed"/>
                                <TextBlock Text="Display a detailed dialog when errors occur with option to report on GitHub."
                                           Foreground="Gray" Margin="20,5,0,0" FontSize="11"/>

                                <CheckBox x:Name="IncludeProfileInCrashReportCheckBox" Content="Include profile name in crash reports"
                                          Margin="20,10,0,0"
                                          Checked="IncludeProfileInCrashReport_Changed" Unchecked="IncludeProfileInCrashReport_Changed"/>
                                <TextBlock Text="When enabled, the active profile name is included in crash reports."
                                           Foreground="Gray" Margin="40,5,0,0" FontSize="11"/>
                            </StackPanel>
                        </GroupBox>

                        <!-- Quick Add Game Hotkey -->
                        <GroupBox Grid.Row="1" Header="Quick Add Game Hotkey" Margin="0,0,0,10">
                            <StackPanel Margin="10">
                                <CheckBox x:Name="AddGameHotkeyEnabledCheckBox" Content="Enable global hotkey"
                                          Checked="AddGameHotkeyEnabled_Changed" Unchecked="AddGameHotkeyEnabled_Changed"/>
                                <TextBlock Text="Press the hotkey while a game is focused to add it to the running profile."
                                           Foreground="Gray" Margin="20,5,0,0" FontSize="11" TextWrapping="Wrap"/>

                                <StackPanel Orientation="Horizontal" Margin="0,15,0,0">
                                    <TextBlock Text="Hotkey:" VerticalAlignment="Center"/>
                                    <TextBlock x:Name="HotkeyText" Text="Ctrl + Shift + G" FontWeight="Bold"
                                               Margin="10,0,0,0" VerticalAlignment="Center"/>
                                    <Button Content="Change..." Padding="10,3" Margin="15,0,0,0"
                                            Click="ChangeHotkey_Click"/>
                                </StackPanel>

                                <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                                    <TextBlock Text="Status:" VerticalAlignment="Center"/>
                                    <TextBlock x:Name="HotkeyStatusText" Text="Active" FontWeight="Bold"
                                               Foreground="Green" Margin="10,0,0,0" VerticalAlignment="Center"/>
                                </StackPanel>
                                <TextBlock Text="If 'Inactive', the hotkey may be in use by another application."
                                           Foreground="Gray" Margin="20,5,0,0" FontSize="11"/>
                            </StackPanel>
                        </GroupBox>

                        <!-- Startup -->
                        <GroupBox Grid.Row="2" Header="Startup" Margin="0,0,0,10">
                            <StackPanel Margin="10">
                                <CheckBox x:Name="StartWithWindowsCheckBox" Content="Start with Windows"
                                          Checked="StartWithWindows_Changed" Unchecked="StartWithWindows_Changed"/>
                                <TextBlock Text="Application will start minimized to tray when Windows starts."
                                           Foreground="Gray" Margin="20,5,0,0" FontSize="11"/>
                                <TextBlock x:Name="StartWithWindowsPortableWarning"
                                           Text="Not available in portable mode — the exe path may change."
                                           Foreground="#FFA500" Margin="20,5,0,0" FontSize="11"
                                           Visibility="Collapsed"/>

                                <StackPanel Orientation="Horizontal" Margin="0,15,0,0">
                                    <TextBlock Text="Startup Profile:" VerticalAlignment="Center"/>
                                    <ComboBox x:Name="StartupProfileComboBox" Width="200" Margin="10,0,0,0"
                                              SelectionChanged="StartupProfile_Changed"/>
                                </StackPanel>
                                <TextBlock Text="Profile to start automatically when the application launches."
                                           Foreground="Gray" Margin="20,5,0,0" FontSize="11"/>
                            </StackPanel>
                        </GroupBox>

                        <!-- Administrator -->
                        <GroupBox Grid.Row="3" Header="Administrator" Margin="0,0,0,10">
                            <StackPanel Margin="10">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Running as Administrator: " VerticalAlignment="Center"/>
                                    <TextBlock x:Name="AdminStatusText" Text="No" FontWeight="Bold" VerticalAlignment="Center"/>
                                </StackPanel>
                                <TextBlock Text="Some devices may require administrator privileges to access."
                                           Foreground="Gray" Margin="0,5,0,0" FontSize="11"/>
                                <Button x:Name="RestartAsAdminButton" Content="Restart as Administrator"
                                        Padding="15,5" Margin="0,10,0,0" HorizontalAlignment="Left"
                                        Click="RestartAsAdmin_Click"/>
                            </StackPanel>
                        </GroupBox>

                        <!-- Command Line -->
                        <GroupBox Grid.Row="4" Header="Command Line" Margin="0,0,0,10">
                            <StackPanel Margin="10">
                                <StackPanel Orientation="Horizontal">
                                    <CheckBox x:Name="AddToPathCheckBox" Content="Add to System PATH"
                                              Checked="AddToPath_Changed" Unchecked="AddToPath_Changed"/>
                                    <TextBlock Text="?" FontWeight="Bold" Foreground="#64B5F6" Margin="10,0,0,0"
                                               VerticalAlignment="Center" Cursor="Hand"
                                               MouseLeftButtonUp="PathHelp_Click"
                                               ToolTip="Click for help"/>
                                </StackPanel>
                                <TextBlock Text="Enable to run 'XOutputRedux start MyProfile' from any terminal."
                                           Foreground="Gray" Margin="20,5,0,0" FontSize="11"/>
                            </StackPanel>
                        </GroupBox>

                        <!-- Backup & Restore -->
                        <GroupBox Grid.Row="5" Header="Backup &amp; Restore" Margin="0,0,0,10">
                            <StackPanel Margin="10">
                                <TextBlock Text="Export or import all settings, profiles, and game associations."
                                           Foreground="Gray" FontSize="11" Margin="0,0,0,10"/>
                                <StackPanel Orientation="Horizontal">
                                    <Button x:Name="BackupSettingsButton" Content="Backup Settings..."
                                            Padding="15,5" Click="BackupSettings_Click"/>
                                    <Button x:Name="RestoreSettingsButton" Content="Restore Settings..."
                                            Padding="15,5" Margin="10,0,0,0" Click="RestoreSettings_Click"/>
                                </StackPanel>
                            </StackPanel>
                        </GroupBox>

                        <!-- Stream Deck -->
                        <GroupBox Grid.Row="6" Header="Stream Deck">
                            <StackPanel Margin="10">
                                <TextBlock Text="Install the Stream Deck plugin to control XOutputRedux from your Elgato Stream Deck."
                                           TextWrapping="Wrap" Margin="0,0,0,10"/>
                                <Button x:Name="InstallStreamDeckButton" Content="Install Stream Deck Plugin"
                                        Padding="15,5" HorizontalAlignment="Left"
                                        Click="InstallStreamDeckPlugin_Click"/>
                                <TextBlock Text="Requires Stream Deck software 6.9 or higher."
                                           Foreground="Gray" Margin="0,5,0,0" FontSize="11"/>
                                <TextBlock x:Name="PortableModeWarning"
                                           Text="⚠ Portable mode: Stream Deck plugin reads profiles from AppData, not the portable location."
                                           Foreground="#FFA500" TextWrapping="Wrap" Margin="0,8,0,0" FontSize="11"
                                           Visibility="Collapsed"/>
                            </StackPanel>
                        </GroupBox>
                        <!-- Plugins -->
                        <GroupBox Grid.Row="7" Header="Plugins" Margin="0,0,0,10">
                            <StackPanel Margin="10">
                                <TextBlock Text="Install optional plugins to add device-specific features (e.g., Moza wheel settings)."
                                           TextWrapping="Wrap" Margin="0,0,0,10"/>
                                <Button x:Name="InstallPluginButton" Content="Install Plugin..."
                                        Padding="15,5" HorizontalAlignment="Left"
                                        Click="InstallPlugin_Click"/>
                                <TextBlock Text="Plugins are .xoutputreduxplugin files. Restart the app after installing."
                                           Foreground="Gray" Margin="0,5,0,0" FontSize="11"/>
                            </StackPanel>
                        </GroupBox>
                    </Grid>
                    </ScrollViewer>
                </TabItem>

                <!-- Test Tab -->
                <TabItem Header="Test">
                    <local:XboxControllerTestView x:Name="TestView" Margin="10"/>
                </TabItem>

                <!-- About Tab -->
                <TabItem Header="About">
                    <Grid Margin="20">
                        <StackPanel VerticalAlignment="Top" HorizontalAlignment="Left" MaxWidth="500">
                            <!-- App Logo and Title -->
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                                <!-- XOutput Redux Logo -->
                                <Viewbox Width="80" Height="80" Stretch="Uniform" Margin="0,0,15,0">
                                    <Grid Width="200" Height="200">
                                        <Path Fill="{DynamicResource SynthwaveRetroBrush}"
                                              Data="M100,0 C44.77,0 0,44.77 0,100 C0,155.23 44.77,200 100,200 C155.23,200 200,155.23 200,100 C200,44.77 155.23,0 100,0 Z M100,175 C58.58,175 25,141.42 25,100 C25,58.58 58.58,25 100,25 C141.42,25 175,58.58 175,100 C175,141.42 141.42,175 100,175 Z" />
                                        <Path Fill="{DynamicResource SynthwaveRetroBrush}" Margin="45"
                                              Data="M105.66,63.34 C109.57,59.44 109.57,53.1 105.66,49.2 C101.76,45.29 95.43,45.29 91.52,49.2 L63.34,77.38 L35.16,49.2 C31.25,45.29 24.92,45.29 21.02,49.2 C17.11,53.1 17.11,59.44 21.02,63.34 L49.2,91.52 L21.02,119.7 C17.11,123.6 17.11,129.94 21.02,133.84 C24.92,137.75 31.25,137.75 35.16,133.84 L63.34,105.66 L91.52,133.84 C95.43,137.75 101.76,137.75 105.66,133.84 C109.57,129.94 109.57,123.6 105.66,119.7 L77.48,91.52 L105.66,63.34 Z"
                                              Stretch="Uniform"/>
                                    </Grid>
                                </Viewbox>
                                <StackPanel VerticalAlignment="Center">
                                    <TextBlock Text="XOutputRedux" FontSize="28" FontWeight="Bold"/>
                                    <TextBlock x:Name="VersionText" Text="Version 0.0.0" FontSize="14" Foreground="Gray"/>
                                </StackPanel>
                            </StackPanel>

                            <!-- Updates -->
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                                <Button x:Name="CheckForUpdatesButton" Content="Check for Updates"
                                        Padding="15,5" Click="CheckForUpdatesNow_Click"/>
                                <CheckBox x:Name="CheckForUpdatesCheckBox" Content="Check on startup"
                                          VerticalAlignment="Center" Margin="15,0,0,0"
                                          Checked="CheckForUpdates_Changed" Unchecked="CheckForUpdates_Changed"/>
                            </StackPanel>

                            <!-- Description -->
                            <TextBlock Text="Xbox controller emulator for Windows. Maps inputs from multiple gaming devices to a single emulated Xbox 360 controller."
                                       TextWrapping="Wrap" Margin="0,0,0,20"/>

                            <!-- Links -->
                            <TextBlock Text="Links" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,10"/>
                            <StackPanel Margin="0,0,0,20">
                                <TextBlock Margin="0,0,0,5">
                                    <Hyperlink x:Name="GitHubLink" RequestNavigate="Hyperlink_RequestNavigate"
                                               NavigateUri="https://github.com/d-b-c-e/XOutputRedux">
                                        GitHub Repository
                                    </Hyperlink>
                                </TextBlock>
                                <TextBlock Margin="0,0,0,5">
                                    <Hyperlink x:Name="ReleasesLink" RequestNavigate="Hyperlink_RequestNavigate"
                                               NavigateUri="https://github.com/d-b-c-e/XOutputRedux/releases">
                                        Releases / Downloads
                                    </Hyperlink>
                                </TextBlock>
                                <TextBlock>
                                    <Hyperlink x:Name="IssuesLink" RequestNavigate="Hyperlink_RequestNavigate"
                                               NavigateUri="https://github.com/d-b-c-e/XOutputRedux/issues">
                                        Report an Issue
                                    </Hyperlink>
                                </TextBlock>
                            </StackPanel>

                            <!-- Acknowledgments -->
                            <TextBlock Text="Acknowledgments" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,10"/>
                            <StackPanel Margin="0,0,0,10">
                                <TextBlock Margin="0,0,0,3">
                                    <Hyperlink RequestNavigate="Hyperlink_RequestNavigate"
                                               NavigateUri="https://github.com/nefarius/ViGEmBus">
                                        ViGEmBus
                                    </Hyperlink>
                                    <Run Text=" - Virtual gamepad driver"/>
                                </TextBlock>
                                <TextBlock Margin="0,0,0,3">
                                    <Hyperlink RequestNavigate="Hyperlink_RequestNavigate"
                                               NavigateUri="https://github.com/nefarius/HidHide">
                                        HidHide
                                    </Hyperlink>
                                    <Run Text=" - Device hiding driver"/>
                                </TextBlock>
                                <TextBlock Margin="0,0,0,3">
                                    <Hyperlink RequestNavigate="Hyperlink_RequestNavigate"
                                               NavigateUri="https://github.com/csutorasa/XOutput">
                                        XOutput
                                    </Hyperlink>
                                    <Run Text=" - Original inspiration"/>
                                </TextBlock>
                            </StackPanel>

                            <!-- Portable Mode Indicator -->
                            <TextBlock x:Name="PortableModeText" Text="Running in portable mode"
                                       Foreground="#FFA500" Margin="0,20,0,0" Visibility="Collapsed"/>
                        </StackPanel>
                    </Grid>
                </TabItem>
            </TabControl>

            <!-- Status Bar -->
            <StatusBar Grid.Row="2" Margin="0,10,0,0">
                <StatusBarItem>
                    <TextBlock x:Name="StatusText" Text="Ready"/>
                </StatusBarItem>
            </StatusBar>
        </Grid>
    </Grid>
</Window>
